{"version":3,"sources":["webpack:///./src/directives/action/index.ts?1f08","webpack:///./src/directives/action/directives/autocomplete.directive.ts?1b99"],"names":[],"mappings":"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","file":"0.d50bde7e56d3bc5beff1.hot-update.js","sourcesContent":["import './services/utils.service';\nimport './services/action.provider';\nimport './services/layout.provider';\nimport './services/autocomplete.provider';\nimport './services/jsoneditor.provider';\nimport './services/validator.custom.value';\n\n// import './schemas/modules.value';\n// import './schemas/common.value';\n// import './schemas/backup.value';\n// import './schemas/schema.value';\n// import './schemas/interface.value';\n// import './schemas/action.value';\nimport './schemas/local.value';\n\nimport './directives/form.directive';\nimport './directives/list.directive';\nimport './directives/autocomplete.directive';\nimport './directives/dialog-form.directive';\nimport './directives/search.directive';\nimport './directives/wizard.directive';\nimport './directives/dialog-wizard.directive';\nimport './directives/builder.directive';\n\nimport mdl from './module';\n\nimport './index.scss';\n\nexport default mdl;\n\n\n/** WEBPACK FOOTER **\n ** ./src/directives/action/index.ts\n **/","import { module } from '../module';\nimport * as _ from 'lodash';\nimport * as pointer from 'json-pointer';\n\nconst _name = \"fxAutocompleteBoost\";\n\nclass Builder {\n    searchText: string;\n    selected: any;\n\n    constructor(private form, private fxAction, private formData) {\n        this.init();\n    }\n\n    /**\n     * 初始化数据\n     * 如果存在keyField，执行一次搜索\n     * 如果不存在keyField，取出数据，执行onChange方法\n     */\n    init() {\n        let viewModel = null;\n\n        if (!_.isArray(this.form.key)) {\n            return;\n        }\n        if (pointer.has(this.formData, `/${this.form.key.join('/')}`)) {\n            viewModel = pointer.get(this.formData, `/${this.form.key.join('/')}`);\n        }\n\n        if (!viewModel) {\n            return;\n        }\n\n        if (this.form.acOptions.keyField) {\n            this.searchText = viewModel;\n            return this.query(true);\n        }\n        this.searchText = viewModel[this.form.acOptions.textField];\n        this.onChange(viewModel);\n    }\n\n    /**\n     * 当数据变化时，触发事件\n     * @param item 更改后的item\n     */\n    onChange(item) {\n        let curValue;\n        this.selected = item;\n\n        if (_.isEmpty(item) || !this.searchText) {\n            this.selected = null;\n            pointer.remove(this.formData, `/${this.form.key.join('/')}`);\n            return undefined;\n        }\n        if (this.form.acOptions.keyField) {\n            if (pointer.has(item, `/${this.form.acOptions.keyField}`)) {\n                curValue = pointer.get(item, `/${this.form.acOptions.keyField}`);\n                pointer.set(this.formData, `/${this.form.key.join('/')}`, curValue);\n                return curValue;\n            } else {\n                console.error(`autocomplete-1-没有在item中找到${this.form.acOptions.keyField}`);\n                return undefined;\n            }\n        }\n\n        curValue = {};\n        _.each(this.form.items.concat(this.form.acOptions.fields || []), (childItem) => {\n            let keys = [].concat(childItem.key);\n            let childKey = keys.pop();\n\n            if (childKey && pointer.has(item, `/${childKey}`)) {\n                pointer.set(curValue, `/${childKey}`, pointer.get(item, `/${childKey}`));\n            }\n        });\n\n        pointer.set(this.formData, `/${this.form.key.join('/')}`, curValue);\n\n        return curValue;\n    }\n\n    /**\n     * 查询数据，如果存在actionKey，则获取actionKey中的interface数据\n     * 查询接口，返回数据\n     * @returns {any}\n     */\n    query(setValueIfOnlyOne) {\n        let actionModel, clientData = {};\n        let filter = {};\n\n        if (this.form.acOptions.actionKey) {\n            // 设置搜索条件\n            pointer.set(filter, this.form.acOptions.search, this.searchText);\n            // 设置全局条件\n            _.forEach(this.form.acOptions._where, (val, key) => {\n                pointer.set(filter, key, val);\n            });\n            return this.fxAction.getModel(this.form.acOptions.actionKey).then((aModel) => {\n                actionModel = aModel;\n                return this.fxAction.doAction(actionModel.key, filter);\n            }).then((results) => {\n                return this.fxAction.doDealResult(actionModel, results, clientData);\n            }).then((results) => {\n                return results[this.form.acOptions.dataField];\n            }).then((results) => {\n                if (results.length === 1 && setValueIfOnlyOne) {\n                    this.onChange(results[0]);\n                }\n                return results;\n            });\n        }\n\n        return this.form.data || [];\n    }\n}\n\nclass Controller {\n    static $inject = [\"$scope\", \"fxAction\"];\n\n    constructor(private $scope, private fxAction) {\n        let formWithIndex = $scope.copyWithIndex ? $scope.copyWithIndex($scope.$index) : null;\n        let form;\n        const compare = (item) => {\n            if (!_.isArray(item['key'])) {\n                return false;\n            }\n            return item['key'].join('') === $scope.form[\"key\"].join('') ||\n                _.filter(item['key'], (key) => {\n                    return key && !_.isNumber(key);\n                }).join('') === $scope.form[\"key\"].join('');\n        };\n        formWithIndex && (form = _.first(_.filter([formWithIndex], compare)));\n        // 获取copy，填充数组索引\n        !form && formWithIndex && (form = _.first(_.filter(formWithIndex.items, compare)));\n        $scope.boost = new Builder(form ? form : $scope.form, fxAction, $scope.model);\n\n        let onChange = $scope.boost.onChange.bind($scope.boost);\n\n        $scope.$watch($scope.model, (newValue, oldValue) => {\n            \n        });\n\n        $scope.boost.onChange = (item) => {\n            $scope.ngModel.$setViewValue(onChange(item));\n            $scope.ngModel.$commitViewValue();\n        }\n        $scope.options = $scope.form.ngModelOptions;\n\n        $scope.$on(\"$destroy\", () => {\n            $scope.boost = null;\n            $scope.options = null;\n        });\n    }\n}\n\n/**\n * 操作指令,某个表单操作\n * @returns {{restrict: string, template: any, scope: {}, replace: boolean, link: (($scope:IDirectiveScope))}}\n * @constructor\n */\nfunction Directive(): ng.IDirective {\n    return {\n        restrict: 'A',\n        scope: false,\n        require: \"ngModel\",\n        controller: Controller\n    };\n\n}\n\nDirective.$inject = [];\n\nmodule.directive(_name, Directive);\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/directives/action/directives/autocomplete.directive.ts\n **/"],"sourceRoot":""}