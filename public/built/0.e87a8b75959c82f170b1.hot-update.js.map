{"version":3,"sources":["webpack:///0.e87a8b75959c82f170b1.hot-update.js","webpack:///./src/pages/tty/ctls/index.controller.ts?a155","webpack:///./src/pages/tty/router.ts?efce"],"names":["webpackHotUpdate","191","module","exports","__webpack_require__","io","TtyController","$scope","$stateParams","toolbarUtils","materialUtils","fxAction","_this","this","crawlers","logs","itemToolbar","btnBuilder","btnClick","$event","crawler","getModel","then","actionModel","doActionModel","socket","emit","result","ret","showResult","close","showMsg","showErrMsg","msg","toValue","$on","disconnect","init","prototype","on","console","log","bind","socketId","hasOwnProperty","safeApply","_","extend","data","length","pop","unshift","id","$inject","193","index_controller_1","initRouter","$urlRouterProvider","$stateProvider","state","url","permissions","except","only","views","content","controller","controllerAs","template"],"mappings":"AAAAA,iBAAiB,GAEXC,IACA,SAASC,EAAQC,EAASC,GAE/B,YCDD,IAAYC,GAAED,EAAM,KAEpBE,EAAA,WASI,QAAAA,GAAoBC,EAA2BC,EAAiDC,EAAsBC,EAAgDC,GAT1K,GAAAC,GAAAC,IASwBA,MAAAN,SAA2BM,KAAAL,eAAiDK,KAAAJ,eAAsBI,KAAAH,gBAAgDG,KAAAF,WAClKE,KAAKC,YACLD,KAAKE,QACLF,KAAKG,aACDP,EAAaQ,WAAW,OAAQ,OAAUC,SAAS,SAACC,EAAQC,GACxDR,EAAKD,SAASU,SAAS,2BAA2BC,KAAK,SAACC,GACpDX,EAAKD,SAASa,cAAcL,EAAQI,EAAaH,EAAS,WACtDR,EAAKa,OAAOC,KAAK,MAAON,EAAS,SAACO,GAC9B,GAAmB,IAAfA,EAAOC,IAAW,CAClB,GAAID,EAAOE,WACP,MAAOjB,GAAKD,SAASU,SAAS,gBAAgBC,KAAK,SAACC,GAChDX,EAAKD,SAASa,cAAcL,EAAQI,EAAaI,EAAQ,WACrDf,EAAKF,cAAcoB,WAI/BlB,GAAKF,cAAcqB,QAAQ,aAE3BnB,GAAKF,cAAcsB,WAAWL,EAAOM,aAMtDC,WAEPrB,KAAKN,OAAO4B,IAAI,WAAY,WACxBvB,EAAKa,OAAOW,aACZxB,EAAKE,cAETD,KAAKwB,OAwDb,MArDI/B,GAAAgC,UAAAD,KAAA,cAAAzB,GAAAC,IAEIA,MAAKY,OAASpB,EAAG,iCAEjBQ,KAAKY,OAAOc,GAAG,UAAW,WACtBC,QAAQC,IAAI,iBAGhB5B,KAAKY,OAAOc,GAAG,aAAc,WACzB3B,EAAKE,YACLF,EAAKF,cAAcsB,WAAW,kBAC/BU,KAAK7B,OAERA,KAAKY,OAAOc,GAAG,eAAgB,SAAEI,GACzB/B,EAAKE,SAAS8B,eAAeD,IAC7B/B,EAAKF,cAAcmC,UAAUjC,EAAKL,OAAQ,iBAC/BK,GAAKE,SAAS6B,MAG9BD,KAAK7B,OAERA,KAAKY,OAAOc,GAAG,iBAAkB,SAAEZ,GAC3Bf,EAAKE,SAAS8B,eAAejB,EAAOgB,WACpC/B,EAAKF,cAAcmC,UAAUjC,EAAKL,OAAQ,WACtCuC,EAAEC,OAAOnC,EAAKE,SAASa,EAAOgB,UAAWhB,EAAOqB,SAGzDN,KAAK7B,OAERA,KAAKY,OAAOc,GAAG,cAAe,SAAEZ,GACxBf,EAAKG,KAAKkC,OAAS,KACnBrC,EAAKG,KAAKmC,MAEdtC,EAAKF,cAAcmC,UAAUjC,EAAKL,OAAQ,WACtCK,EAAKG,KAAKoC,QAAQxB,EAAOqB,SAE9BN,KAAK7B,OAERA,KAAKY,OAAOc,GAAG,eAAgB,SAAGS,GACzBpC,EAAKE,WACNF,EAAKE,aAETF,EAAKF,cAAcmC,UAAUjC,EAAKL,OAAQ,WACtCK,EAAKE,SAASkC,EAAKI,IAAMJ,EAAKA,QAEnCN,KAAK7B,OAERA,KAAKY,OAAOC,KAAK,iBAAmB,SAAEZ,GAClCF,EAAKF,cAAcmC,UAAUjC,EAAKL,OAAQ,WACtCK,EAAKE,SAAWA,KAErB4B,KAAK7B,QA5FLP,EAAA+C,SAAW,SAAU,eAAgB,eAAgB,gBAAiB,YA8FjF/C,IA/FaH,GAAAG,cAAaA,GD8FpBgD,IACA,SAASpD,EAAQC,EAASC,GAE/B,YEnGD,IAAAmD,GAAAnD,EAA4B,IAEfD,GAAAqD,WAAa,SAACC,EAAoBC,GAE3CA,EAAeC,MAAM,YACjBC,IAAK,MACLZ,MACIa,aACIC,QAAS,aACTC,MAAO,UAGfC,OACIC,SACIC,WAAYX,EAAAjD,cACZ6D,aAAc,SACdC,SAAUhE,EAAQ","file":"0.e87a8b75959c82f170b1.hot-update.js","sourcesContent":["webpackHotUpdate(0,{\n\n/***/ 191:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar io = __webpack_require__(139);\n\tvar TtyController = (function () {\n\t    function TtyController($scope, $stateParams, toolbarUtils, materialUtils, fxAction) {\n\t        var _this = this;\n\t        this.$scope = $scope;\n\t        this.$stateParams = $stateParams;\n\t        this.toolbarUtils = toolbarUtils;\n\t        this.materialUtils = materialUtils;\n\t        this.fxAction = fxAction;\n\t        this.crawlers = {};\n\t        this.logs = [];\n\t        this.itemToolbar = [\n\t            toolbarUtils.btnBuilder(\"执行操作\", \"\", true).btnClick(function ($event, crawler) {\n\t                _this.fxAction.getModel(\"crawlerSettingAckAction\").then(function (actionModel) {\n\t                    _this.fxAction.doActionModel($event, actionModel, crawler, function () {\n\t                        _this.socket.emit('ack', crawler, function (result) {\n\t                            if (result.ret === 0) {\n\t                                if (result.showResult) {\n\t                                    return _this.fxAction.getModel(\"resultAction\").then(function (actionModel) {\n\t                                        _this.fxAction.doActionModel($event, actionModel, result, function () {\n\t                                            _this.materialUtils.close();\n\t                                        });\n\t                                    });\n\t                                }\n\t                                _this.materialUtils.showMsg(\"操作成功！\");\n\t                            }\n\t                            else {\n\t                                _this.materialUtils.showErrMsg(result.msg);\n\t                            }\n\t                        });\n\t                    });\n\t                });\n\t            }).toValue()\n\t        ];\n\t        this.$scope.$on(\"$destroy\", function () {\n\t            _this.socket.disconnect();\n\t            _this.crawlers = {};\n\t        });\n\t        this.init();\n\t    }\n\t    TtyController.prototype.init = function () {\n\t        var _this = this;\n\t        this.socket = io('http://localhost:3000/crawler');\n\t        this.socket.on('connect', function () {\n\t            console.log(\"connected!!\");\n\t        });\n\t        this.socket.on('disconnect', (function () {\n\t            _this.crawlers = {};\n\t            _this.materialUtils.showErrMsg(\"socket失去连接！！！\");\n\t        }).bind(this));\n\t        this.socket.on(\"crawler:left\", (function (socketId) {\n\t            if (_this.crawlers.hasOwnProperty(socketId)) {\n\t                _this.materialUtils.safeApply(_this.$scope, function () {\n\t                    delete _this.crawlers[socketId];\n\t                });\n\t            }\n\t        }).bind(this));\n\t        this.socket.on(\"crawler:update\", (function (result) {\n\t            if (_this.crawlers.hasOwnProperty(result.socketId)) {\n\t                _this.materialUtils.safeApply(_this.$scope, function () {\n\t                    _.extend(_this.crawlers[result.socketId], result.data);\n\t                });\n\t            }\n\t        }).bind(this));\n\t        this.socket.on(\"crawler:log\", (function (result) {\n\t            if (_this.logs.length > 100) {\n\t                _this.logs.pop();\n\t            }\n\t            _this.materialUtils.safeApply(_this.$scope, function () {\n\t                _this.logs.unshift(result.data);\n\t            });\n\t        }).bind(this));\n\t        this.socket.on('crawler:join', (function (data) {\n\t            if (!_this.crawlers) {\n\t                _this.crawlers = {};\n\t            }\n\t            _this.materialUtils.safeApply(_this.$scope, function () {\n\t                _this.crawlers[data.id] = data.data;\n\t            });\n\t        }).bind(this));\n\t        this.socket.emit(\"getCrawlers\", {}, (function (crawlers) {\n\t            _this.materialUtils.safeApply(_this.$scope, function () {\n\t                _this.crawlers = crawlers;\n\t            });\n\t        }).bind(this));\n\t    };\n\t    TtyController.$inject = [\"$scope\", \"$stateParams\", \"toolbarUtils\", \"materialUtils\", \"fxAction\"];\n\t    return TtyController;\n\t}());\n\texports.TtyController = TtyController;\n\n\n/***/ },\n\n/***/ 193:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar index_controller_1 = __webpack_require__(191);\n\texports.initRouter = function ($urlRouterProvider, $stateProvider) {\n\t    $stateProvider.state(\"home.tty\", {\n\t        url: \"tty\",\n\t        data: {\n\t            permissions: {\n\t                except: [\"anonymous\"],\n\t                only: [\"user\"]\n\t            }\n\t        },\n\t        views: {\n\t            \"content\": {\n\t                controller: index_controller_1.TtyController,\n\t                controllerAs: \"ttyCtl\",\n\t                template: __webpack_require__(131)()\n\t            }\n\t        }\n\t    });\n\t};\n\n\n/***/ }\n\n})\n\n\n/** WEBPACK FOOTER **\n ** 0.e87a8b75959c82f170b1.hot-update.js\n **/","/**\n * Created by NICK on 16/8/10.\n */\n\nimport * as io from 'socket.io-client';\n\nexport class TtyController {\n    static $inject = [\"$scope\", \"$stateParams\", \"toolbarUtils\", \"materialUtils\", \"fxAction\"];\n\n    toolbar: Array<Object>;\n    itemToolbar: Array<Object>;\n    socket: SocketIOClient.Socket;\n    crawlers: {[id: string]: any};\n    logs: Array<any>;\n\n    constructor(private $scope: ng.IScope, private $stateParams: ng.ui.IStateParamsService, private toolbarUtils, private materialUtils: fx.utils.materialStatic, private fxAction) {\n        this.crawlers = {};\n        this.logs = [];\n        this.itemToolbar = [\n            toolbarUtils.btnBuilder(\"执行操作\", \"\", true).btnClick(($event, crawler)=> {\n                this.fxAction.getModel(\"crawlerSettingAckAction\").then((actionModel)=> {\n                    this.fxAction.doActionModel($event, actionModel, crawler, ()=> {\n                        this.socket.emit('ack', crawler, (result)=> {\n                            if (result.ret === 0) {\n                                if (result.showResult) {\n                                    return this.fxAction.getModel(\"resultAction\").then((actionModel)=> {\n                                        this.fxAction.doActionModel($event, actionModel, result, ()=> {\n                                            this.materialUtils.close();\n                                        });\n                                    });\n                                }\n                                this.materialUtils.showMsg(\"操作成功！\");\n                            } else {\n                                this.materialUtils.showErrMsg(result.msg);\n                            }\n                        });\n\n                    });\n                });\n            }).toValue()\n        ];\n        this.$scope.$on(\"$destroy\", ()=> {\n            this.socket.disconnect();\n            this.crawlers = {};\n        });\n        this.init();\n    }\n\n    init() {\n        // this.socket = io('http://114.55.146.215:3000/crawler');\n        this.socket = io('http://localhost:3000/crawler');\n        // 已经连接\n        this.socket.on('connect', function () {\n            console.log(\"connected!!\");\n        });\n        // 失去连接\n        this.socket.on('disconnect', (()=> {\n            this.crawlers = {};\n            this.materialUtils.showErrMsg(\"socket失去连接！！！\");\n        }).bind(this));\n        // 爬虫进程退出事件\n        this.socket.on(\"crawler:left\", ((socketId)=> {\n            if (this.crawlers.hasOwnProperty(socketId)) {\n                this.materialUtils.safeApply(this.$scope, ()=> {\n                    delete this.crawlers[socketId];\n                });\n            }\n        }).bind(this));\n        // 爬虫进程更新事件\n        this.socket.on(\"crawler:update\", ((result)=> {\n            if (this.crawlers.hasOwnProperty(result.socketId)) {\n                this.materialUtils.safeApply(this.$scope, ()=> {\n                    _.extend(this.crawlers[result.socketId], result.data);\n                });\n            }\n        }).bind(this));\n        // 爬虫进程更新事件\n        this.socket.on(\"crawler:log\", ((result)=> {\n            if (this.logs.length > 100) {\n                this.logs.pop();\n            }\n            this.materialUtils.safeApply(this.$scope, ()=> {\n                this.logs.unshift(result.data);\n            });\n        }).bind(this));\n        // 爬虫进程连接事件\n        this.socket.on('crawler:join', ( (data)=> {\n            if (!this.crawlers) {\n                this.crawlers = {};\n            }\n            this.materialUtils.safeApply(this.$scope, ()=> {\n                this.crawlers[data.id] = data.data;\n            });\n        }).bind(this));\n        // 获取所有爬虫进程\n        this.socket.emit(\"getCrawlers\", {}, ((crawlers)=> {\n            this.materialUtils.safeApply(this.$scope, ()=> {\n                this.crawlers = crawlers;\n            });\n        }).bind(this));\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/pages/tty/ctls/index.controller.ts\n **/","/**\n * Created by NICK on 16/8/9.\n */\n\nimport {TtyController} from './ctls/index.controller';\n\nexport const initRouter = ($urlRouterProvider, $stateProvider) => {\n    // 路由规则\n    $stateProvider.state(\"home.tty\", {\n        url: \"tty\",\n        data: {\n            permissions: {\n                except: [\"anonymous\"],\n                only: [\"user\"]\n            }\n        },\n        views: {\n            \"content\": {\n                controller: TtyController,\n                controllerAs: \"ttyCtl\",\n                template: require(\"./tpls/index.template.jade\")()\n            }\n        }\n    });\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/pages/tty/router.ts\n **/"],"sourceRoot":""}