{"version":3,"sources":["webpack:///./src/pages/tty/router.ts?efce","webpack:///./src/pages/tty/ctls/index.controller.ts?a155"],"names":[],"mappings":";;;;;;AAIA,8CAA4B,GAAyB,CAAC;AAEzC,mBAAU,GAAG,UAAC,kBAAkB,EAAE,cAAc;KAEzD,cAAc,CAAC,KAAK,CAAC,UAAU,EAAE;SAC7B,GAAG,EAAE,UAAU;SACf,IAAI,EAAE;aACF,WAAW,EAAE;iBACT,MAAM,EAAE,CAAC,WAAW,CAAC;iBACrB,IAAI,EAAE,CAAC,MAAM,CAAC;cACjB;UACJ;SACD,KAAK,EAAE;aACH,SAAS,EAAE;iBACP,UAAU,EAAE,gCAAa;iBACzB,YAAY,EAAE,QAAQ;iBACtB,QAAQ,EAAE,mBAAO,CAAC,GAA4B,CAAC,EAAE;cACpD;UACJ;MACJ,CAAC,CAAC;AACP,EAAC,CAAC;;;;;;;;;ACxBF,KAAY,EAAE,uBAAM,GAAkB,CAAC;AAEvC,KAAM,EAAE,GAAG,mCAAmC,CAAC;AAE/C;KAYI,uBAAoB,UAAgC,EAAU,MAAiB,EAAU,YAAuC,EAAU,YAAY,EAAU,aAAsC,EAAU,QAAQ;SAZ5N,iBA6HC;SAjHuB,eAAU,GAAV,UAAU,CAAsB;SAAU,WAAM,GAAN,MAAM,CAAW;SAAU,iBAAY,GAAZ,YAAY,CAA2B;SAAU,iBAAY,GAAZ,YAAY;SAAU,kBAAa,GAAb,aAAa,CAAyB;SAAU,aAAQ,GAAR,QAAQ;SAHxN,aAAQ,GAAY,IAAI,CAAC;SACzB,eAAU,GAAW,CAAC,CAAC;SAGnB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;SACnB,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;SACf,IAAI,CAAC,YAAY,GAAG;aAChB,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,mDAAmD,CAAC,CAAC,WAAW,CAAC,EAAC,IAAI,EAAE,EAAE,EAAC,CAAC,CAAC,OAAO,EAAE;aACrH,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,EAAE,gBAAgB,EAAE,KAAK,CAAC,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,UAAC,MAAM;iBACnG,KAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;aACzB,CAAC,CAAC,CAAC,OAAO,EAAE;aACZ,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,mCAAmC,EAAE,gBAAgB,EAAE,KAAK,CAAC,CAAC,WAAW,CAAC,mDAAmD,CAAC,CAAC,QAAQ,CAAC,UAAC,MAAM;iBACxK,KAAI,CAAC,QAAQ,GAAG,CAAC,KAAI,CAAC,QAAQ,CAAC;aACnC,CAAC,CAAC,CAAC,OAAO,EAAE;UACf,CAAC;SACF,IAAI,CAAC,OAAO,GAAG;aACX,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,cAAc,EAAE,EAAC,IAAI,EAAE,OAAO,EAAC,CAAC,CAAC,OAAO,EAAE;aAC5F,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,WAAW,CAAC,EAAC,IAAI,EAAE,EAAE,EAAC,CAAC,CAAC,OAAO,EAAE;aAC1E,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,mCAAmC,EAAE,gBAAgB,EAAE,KAAK,CAAC,CAAC,WAAW,CAAC,mDAAmD,EAAE,EAAC,IAAI,EAAE,OAAO,EAAC,CAAC,CAAC,QAAQ,CAAC,UAAC,MAAM;iBACzL,KAAI,CAAC,QAAQ,GAAG,CAAC,KAAI,CAAC,QAAQ,CAAC;aACnC,CAAC,CAAC,CAAC,OAAO,EAAE;UACf,CAAC;SACF,IAAI,CAAC,WAAW,GAAG;aACf,YAAY,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,QAAQ,CAAC,UAAC,MAAM,EAAE,OAAO;iBACtE,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,yBAAyB,CAAC,CAAC,IAAI,CAAC,UAAC,WAAW;qBAC/D,KAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE;yBACtD,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,EAAE,UAAC,MAAM;6BACpC,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;iCACnB,EAAE,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;qCACpB,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,UAAC,WAAW;yCAC3D,KAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE;6CACrD,KAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;yCAC/B,CAAC,CAAC,CAAC;qCACP,CAAC,CAAC,CAAC;iCACP,CAAC;iCACD,KAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;6BACxC,CAAC;6BAAC,IAAI,CAAC,CAAC;iCACJ,KAAI,CAAC,aAAa,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;6BAC9C,CAAC;yBACL,CAAC,CAAC,CAAC;qBAEP,CAAC,CAAC,CAAC;iBACP,CAAC,CAAC,CAAC;aACP,CAAC,CAAC,CAAC,OAAO,EAAE;UACf,CAAC;SACF,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE;aACxB,KAAI,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;aACzB,KAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;SACvB,CAAC,CAAC,CAAC;SACH,IAAI,CAAC,IAAI,EAAE,CAAC;KAChB,CAAC;KAED,4BAAI,GAAJ;SAAA,iBA+DC;SA9DG,IAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;SAEvD,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;aACT,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;SACnC,CAAC;SACD,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SACpB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;SAGrB,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE;aAAA,iBAOzB;aALG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE,EAAE,CAAC,UAAC,QAAQ;iBAC1C,KAAI,CAAC,aAAa,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAE;qBACtC,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;iBAC7B,CAAC,CAAC,CAAC;aACP,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SACnB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAEd,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC;aAC1B,KAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;aACnB,KAAI,CAAC,aAAa,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;SACnD,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAEf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,UAAC,QAAQ;aACrC,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;iBACzC,KAAI,CAAC,aAAa,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAE;qBACtC,OAAO,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;iBACnC,CAAC,CAAC,CAAC;aACP,CAAC;SACL,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAEf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,gBAAgB,EAAE,CAAC,UAAC,MAAM;aACrC,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;iBAChD,KAAI,CAAC,aAAa,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAE;qBACtC,CAAC,CAAC,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;iBAC1D,CAAC,CAAC,CAAC;aACP,CAAC;SACL,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAEf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC,UAAC,MAAM;aAClC,EAAE,CAAC,CAAC,KAAI,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC;iBACzB,KAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;aACpB,CAAC;aACD,KAAI,CAAC,aAAa,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAE;iBACtC,KAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;iBAE/B,KAAI,CAAC,UAAU,GAAG,CAAC,CAAC,MAAM,CAAC,KAAI,CAAC,IAAI,EAAE,UAAC,GAAG;qBACtC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC;iBACzB,CAAC,CAAC,CAAC,MAAM,CAAC;aAEd,CAAC,CAAC,CAAC;SACP,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAEf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE,CAAE,UAAC,IAAI;aAClC,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;iBACjB,KAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;aACvB,CAAC;aACD,KAAI,CAAC,aAAa,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAE;iBACtC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC;aACvC,CAAC,CAAC,CAAC;SACP,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;KAEnB,CAAC;KA3HM,qBAAO,GAAG,CAAC,YAAY,EAAE,QAAQ,EAAE,cAAc,EAAE,cAAc,EAAE,eAAe,EAAE,UAAU,CAAC,CAAC;KA4H3G,oBAAC;AAAD,EAAC;AA7HY,sBAAa,gBA6HzB","file":"0.4405ff231f01962cba29.hot-update.js","sourcesContent":["/**\n * Created by NICK on 16/8/9.\n */\n\nimport {TtyController} from './ctls/index.controller';\n\nexport const initRouter = ($urlRouterProvider, $stateProvider) => {\n    // 路由规则\n    $stateProvider.state(\"home.tty\", {\n        url: \"tty/:key\",\n        data: {\n            permissions: {\n                except: [\"anonymous\"],\n                only: [\"user\"]\n            }\n        },\n        views: {\n            \"content\": {\n                controller: TtyController,\n                controllerAs: \"ttyCtl\",\n                template: require(\"./tpls/index.template.jade\")()\n            }\n        }\n    });\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/pages/tty/router.ts\n **/","import * as io from 'socket.io-client';\n\nconst ip = \"http://106.75.78.203:3000/crawler\";\n\nexport class TtyController {\n    static $inject = [\"$rootScope\", \"$scope\", \"$stateParams\", \"toolbarUtils\", \"materialUtils\", \"fxAction\"];\n\n    toolbar: Array<any>;\n    toolbar_logs: Array<any>;\n    itemToolbar: Array<Object>;\n    socket: SocketIOClient.Socket;\n    crawlers: {[id: string]: any};\n    logs: Array<any>;\n    showLogs: boolean = true;\n    errorCount: number = 0;\n\n    constructor(private $rootScope: ng.IRootScopeService, private $scope: ng.IScope, private $stateParams: ng.ui.IStateParamsService, private toolbarUtils, private materialUtils: fx.utils.materialStatic, private fxAction) {\n        this.crawlers = {};\n        this.logs = [];\n        this.toolbar_logs = [\n            this.toolbarUtils.labelBuilder('爬取日志-{{ttyCtl.errorCount/(this.logs.length||1)}}%').attrBuilder({flex: \"\"}).toValue(),\n            this.toolbarUtils.btnBuilder(\"清空日志\", \"md-icon-button\", false).iconBuilder(\"clear_all\").btnClick(($event)=> {\n                this.logs.length = 0;\n            }).toValue(),\n            this.toolbarUtils.btnBuilder(\"{{ttyCtl.showLogs?'关闭日志':'打开日志'}}\", \"md-icon-button\", false).iconBuilder(\"{{ttyCtl.showLogs?'window-open':'window-closed'}}\").btnClick(($event)=> {\n                this.showLogs = !this.showLogs;\n            }).toValue()\n        ];\n        this.toolbar = [\n            this.toolbarUtils.noneBuilder(\"icon\").iconBuilder('power-socket', {fill: \"black\"}).toValue(),\n            this.toolbarUtils.labelBuilder('爬虫进程管理').attrBuilder({flex: \"\"}).toValue(),\n            this.toolbarUtils.btnBuilder(\"{{ttyCtl.showLogs?'关闭日志':'打开日志'}}\", \"md-icon-button\", false).iconBuilder(\"{{ttyCtl.showLogs?'window-open':'window-closed'}}\", {fill: \"black\"}).btnClick(($event)=> {\n                this.showLogs = !this.showLogs;\n            }).toValue()\n        ];\n        this.itemToolbar = [\n            toolbarUtils.btnBuilder(\"执行操作\", \"\", true, \"top\").btnClick(($event, crawler)=> {\n                this.fxAction.getModel(\"crawlerSettingAckAction\").then((actionModel)=> {\n                    this.fxAction.doActionModel($event, actionModel, crawler, ()=> {\n                        this.socket.emit('ack', crawler, (result)=> {\n                            if (result.ret === 0) {\n                                if (result.showResult) {\n                                    return this.fxAction.getModel(\"resultAction\").then((actionModel)=> {\n                                        this.fxAction.doActionModel($event, actionModel, result, ()=> {\n                                            this.materialUtils.close();\n                                        });\n                                    });\n                                }\n                                this.materialUtils.showMsg(\"操作成功！\");\n                            } else {\n                                this.materialUtils.showErrMsg(result.msg);\n                            }\n                        });\n\n                    });\n                });\n            }).toValue()\n        ];\n        this.$scope.$on(\"$destroy\", ()=> {\n            this.socket.disconnect();\n            this.crawlers = {};\n        });\n        this.init();\n    }\n\n    init() {\n        const config = this.fxAction.getInjector(\"siteConfig\");\n\n        if (config) {\n            return console.error(\"没有配置项！\");\n        }\n        console.log(config);\n        this.socket = io(ip);\n        // this.socket = io('http://localhost:3000/crawler');\n        // 已经连接\n        this.socket.on('connect', function () {\n            // 获取所有爬虫进程\n            this.socket.emit(\"getCrawlers\", {}, ((crawlers)=> {\n                this.materialUtils.safeApply(this.$scope, ()=> {\n                    this.crawlers = crawlers;\n                });\n            }).bind(this));\n        }.bind(this));\n        // 失去连接\n        this.socket.on('disconnect', (()=> {\n            this.crawlers = {};\n            this.materialUtils.showErrMsg(\"socket失去连接！！！\");\n        }).bind(this));\n        // 爬虫进程退出事件\n        this.socket.on(\"crawler:left\", ((socketId)=> {\n            if (this.crawlers.hasOwnProperty(socketId)) {\n                this.materialUtils.safeApply(this.$scope, ()=> {\n                    delete this.crawlers[socketId];\n                });\n            }\n        }).bind(this));\n        // 爬虫进程更新事件\n        this.socket.on(\"crawler:update\", ((result)=> {\n            if (this.crawlers.hasOwnProperty(result.socketId)) {\n                this.materialUtils.safeApply(this.$scope, ()=> {\n                    _.extend(this.crawlers[result.socketId], result.data);\n                });\n            }\n        }).bind(this));\n        // 爬虫进程更新事件\n        this.socket.on(\"crawler:log\", ((result)=> {\n            if (this.logs.length > 100) {\n                this.logs.pop();\n            }\n            this.materialUtils.safeApply(this.$scope, ()=> {\n                this.logs.unshift(result.data);\n\n                this.errorCount = _.filter(this.logs, (log)=> {\n                    return !!log.isError;\n                }).length;\n\n            });\n        }).bind(this));\n        // 爬虫进程连接事件\n        this.socket.on('crawler:join', ( (data)=> {\n            if (!this.crawlers) {\n                this.crawlers = {};\n            }\n            this.materialUtils.safeApply(this.$scope, ()=> {\n                this.crawlers[data.id] = data.data;\n            });\n        }).bind(this));\n\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/pages/tty/ctls/index.controller.ts\n **/"],"sourceRoot":""}