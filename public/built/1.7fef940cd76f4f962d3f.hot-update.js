webpackHotUpdate(1,{186:function(e,t,s){"use strict";function i(){return{restrict:"EA",scope:{},bindToController:{realTime:"@?",_filter:"=?"},template:s(125),controller:n,controllerAs:"executeCmdCtl"}}var o=s(3),c=s(31),n=function(){function e(e,t,s,i,c,n,r){var a=this;this.$scope=e,this.fxAction=t,this.sockets=s,this.$q=i,this.$timeout=c,this.toolbarUtils=n,this.materialUtils=r,this.cmdClientData={},this.cmdResClientData={},this.deviceSelected=[],this.cmdResMap={},this.listKey="executeCmdResList",this.process={fail:0,success:0,total:0},this.realTime&&(this.$scope.$on("socket:connect",function(){}),this.$scope.$on("socket:events",function(e,t){if(console.log("socket",t._source.jid,a.jid),t._source.jid===a.jid){if(a.cmdResMap[t._id]=t,o.isArray(a.cmdResClientData.rows)){var s=o.filter(a.cmdResClientData.rows,function(e){return e._id==t._id});0==s.length?a.cmdResClientData.rows.push(t):o.each(s,function(e,i){o.extend(s[i],t)})}t._source.success?a.process.success++:a.process.fail++,a.process.complete=(a.process.success+a.process.fail)/a.process.total*100}})),this.$scope.$on("showExecuteCmdResult",function(e,t){a.cmdClientData={},a.cmdResClientData={},a.deviceSelected=[],a.cmdResMap={len:0},a.jid="",a.getCommandResult(t)}),this.$scope.$on(this.listKey+":searchComplete",function(e,t){a.resetProcess(),o.each(t.rows,function(e,s){a.cmdResMap.hasOwnProperty(e._id)&&o.extend(t.rows[s],a.cmdResMap[e._id])}),a.setProcess(t.aggregations)}),this.cmdResClientData={},this.toolbars=[this.toolbarUtils.noneBuilder("icon").iconBuilder("apple-keyboard-command",{}).toValue(),this.toolbarUtils.labelBuilder("执行命令").attrBuilder({flex:""}).toValue()]}return e.prototype.resetProcess=function(){this.process.fail=0,this.process.success=0,this.process.complete=0,this.process.buffer=0},e.prototype.setProcess=function(e){var t=this;o.each(e.count_success.buckets,function(e){switch(e.key_as_string){case"true":t.process.success=e.doc_count;break;case"false":t.process.fail=e.doc_count}}),this.process.complete=(this.process.success+this.process.fail)/this.process.total*100,this.process.buffer=100},e.prototype.getCommandResult=function(e){var t=this;this.resFilter={query:{and:[{match:{jid:e}}]}},this.cmdResMap={},this.jid=e,this.realTime=!0,this.isBusy=!0,this.isOpen=!0,this.$q.all([this.fxAction.doAction("executeCmdList",{where:{query:{and:[{match:{_id:e}}]}}})]).then(function(e){t.fxAction.doDealResult(e[0].actionModel,e[0],t.cmdClientData)}).then(function(){return t.cmdClientData.rows.length?(t.command=t.cmdClientData.rows[0]._source.command,void(t.process.total=t.cmdClientData.rows[0]._source.devLen)):t.getCommandResult(e)})["finally"](function(){t.isBusy=!1})},e.$inject=["$scope","fxAction","sockets","$q","$timeout","toolbarUtils","materialUtils"],e}();t.PageExecuteCmdResultController=n,c.module.directive("executeCmd",[i]),c.module.filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),c.module.directive("angularTerminal",["$rootScope",function(e){return{restrict:"A",link:function(t,s,i){var o,c="terminal."+(i.angularTerminal||"default");o=s.terminal(function(t,s){e.$emit(c,t,s)},{greetings:i.greetings||"",enabled:!1}),e.$on(c+".echo",function(e,t){o.echo(t)})}}}])},187:function(e,t,s){"use strict";var i=s(31);s(186),s(188),s(161),Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i["default"]}});
//# sourceMappingURL=1.7fef940cd76f4f962d3f.hot-update.js.map