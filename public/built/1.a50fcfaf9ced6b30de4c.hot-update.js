webpackHotUpdate(1,{186:function(t,e,s){"use strict";function i(){return{restrict:"EA",scope:{},bindToController:{realTime:"@?"},template:s(125),controller:r,controllerAs:"executeCmdCtl"}}var o=s(3),c=s(31),n=s(7),r=function(){function t(t,e,s,i,c,n,r){var a=this;this.$scope=t,this.fxAction=e,this.sockets=s,this.$q=i,this.$timeout=c,this.toolbarUtils=n,this.materialUtils=r,this.cmdClientData={},this.cmdResClientData={},this.deviceSelected=[],this.cmdResMap={},this.listKey="executeCmdResList",this.process={fail:0,success:0,total:0},this.realTime&&(this.$scope.$on("socket:connect",function(){}),this.$scope.$on("socket:events",function(t,e){if(console.log("socket",e._source.jid,a.jid),e._source.jid===a.jid){if(a.cmdResMap[e._id]=e,o.isArray(a.cmdResClientData.rows)){var s=o.filter(a.cmdResClientData.rows,function(t){return t._id==e._id});0==s.length?a.cmdResClientData.rows.push(e):o.each(s,function(t,i){o.extend(s[i],e)})}a.$scope.$emit(a.listKey+":refresh")}}),this.$scope.$watch(function(){return a.isOpen},function(t,e){a.isOpen===!1&&(a.jid="")})),this.$scope.$on("showExecuteCmdResult",function(t,e){a.cmdClientData={},a.cmdResClientData={},a.deviceSelected=[],a.cmdResMap={len:0},a.jid="",a.getCommandResult(e)}),this.$scope.$on(this.listKey+":searchComplete",function(t,e){o.each(e.rows,function(t,s){a.cmdResMap.hasOwnProperty(t._id)&&o.extend(e.rows[s],a.cmdResMap[t._id])}),a.process.total=e.total,a.setProcess(e.aggregations)}),this.cmdResClientData={},this.toolbars=[this.toolbarUtils.noneBuilder("icon").iconBuilder("apple-keyboard-command",{}).toValue(),this.toolbarUtils.labelBuilder("执行命令").attrBuilder({flex:""}).toValue()]}return t.prototype.resetProcess=function(){this.process.fail=0,this.process.success=0,this.process.total=0,this.process.complete=0,this.process.buffer=0},t.prototype.setProcess=function(t){var e=this;o.each(t.count_success.buckets,function(t){switch(t.key_as_string){case"true":e.process.success=t.doc_count;break;case"false":e.process.fail=t.doc_count}}),this.process.complete=(this.process.success+this.process.fail)/this.process.total*100,this.process.buffer=100},t.prototype.getCommandResult=function(t){var e=this,s={};this.jid&&(this.resetProcess(),this.resFilter={},this.cmdResMap={},this.jid=t,this.realTime=!0,this.isBusy=!0,this.isOpen=!0,n.set(s,"/_id/match/-/and",t),n.set(this.resFilter,"/jid/match/-/and",t),this.$q.all([this.fxAction.doAction("executeCmdList",{where:s})]).then(function(t){e.fxAction.doDealResult(t[0].actionModel,t[0],e.cmdClientData)}).then(function(){return e.cmdClientData.rows.length?void(e.command=e.cmdClientData.rows[0]._source.command):e.getCommandResult(t)})["finally"](function(){e.isBusy=!1}))},t.$inject=["$scope","fxAction","sockets","$q","$timeout","toolbarUtils","materialUtils"],t}();e.PageExecuteCmdResultController=r,c.module.directive("executeCmd",[i]),c.module.filter("to_trusted",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]),c.module.directive("angularTerminal",["$rootScope",function(t){return{restrict:"A",link:function(e,s,i){var o,c="terminal."+(i.angularTerminal||"default");o=s.terminal(function(e,s){t.$emit(c,e,s)},{greetings:i.greetings||"",enabled:!1}),t.$on(c+".echo",function(t,e){o.echo(e)})}}}])},187:function(t,e,s){"use strict";var i=s(31);s(186),s(188),s(161),Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=i["default"]}});
//# sourceMappingURL=1.a50fcfaf9ced6b30de4c.hot-update.js.map