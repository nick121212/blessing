{"version":3,"sources":["webpack:///./src/directives/action/index.ts?5e33","webpack:///./src/directives/action/directives/wizard.directive.ts?1ef0"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,6DAA4D,OAAO;AACnE,6DAA4D,OAAO,SAAS,gBAAgB;AAC5F,6DAA4D,OAAO,QAAQ,gBAAgB;AAC3F,6DAA4D,OAAO,aAAa,kBAAkB;AAClG,6DAA4D,OAAO,aAAa,kBAAkB;AAClG,oEAAmE,oBAAoB,GAAG,sBAAsB;AAChH;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,+CAA8C,cAAc;AAC5D;;;;;;;;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA,sBAAqB;AACrB;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA,cAAa;AACb;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;AACA;AACA","file":"0.1df9a5762c100a52c055.hot-update.js","sourcesContent":["\"use strict\";\nvar angular = require('angular');\nvar ngMaterial = require('angular-material');\nrequire('expose?JSONEditor!jsoneditor');\nrequire('ng-jsoneditor');\nvar action_provider_1 = require('./services/action.provider');\nvar utils_service_1 = require('./services/utils.service');\nvar rest_service_1 = require('../../services/rest.service');\nvar login_value_1 = require('./schemas/login.value');\nvar modules_value_1 = require('./schemas/modules.value');\nvar crawler_value_1 = require('./schemas/crawler.value');\nvar common_value_1 = require('./schemas/common.value');\nvar form_directive_1 = require('./directives/form.directive');\nvar list_directive_1 = require('./directives/list.directive');\nvar dialog_form_directive_1 = require('./directives/dialog-form.directive');\nvar search_directive_1 = require('./directives/search.directive');\nvar wizard_directive_1 = require('./directives/wizard.directive');\nvar dialog_wizard_directive_1 = require('./directives/dialog-wizard.directive');\nvar builder_directive_1 = require('./directives/builder.directive');\nvar autocomplete_provider_1 = require('./services/autocomplete.provider');\nvar jsoneditor_provider_1 = require('./services/jsoneditor.provider');\nrequire('angular-schema-form');\nrequire('angular-schema-form-ng-material');\nrequire('./services/validator.custom.value');\nvar _name = \"fxAction\";\nvar module = angular.module(_name + \"Module\", [ngMaterial, rest_service_1.default, \"schemaForm\", \"ng.jsoneditor\"]);\nutils_service_1.default(module);\naction_provider_1.default(module);\nform_directive_1.default(module);\nlist_directive_1.default(module);\nmodules_value_1.default(module);\nlogin_value_1.default(module);\ndialog_form_directive_1.default(module);\nsearch_directive_1.default(module);\nwizard_directive_1.default(module);\ndialog_wizard_directive_1.default(module);\nbuilder_directive_1.default(module);\ncrawler_value_1.default(module);\ncommon_value_1.default(module);\nautocomplete_provider_1.default(module);\njsoneditor_provider_1.default(module);\nfunction sfLayout(args) {\n    var layoutDiv = args.fieldFrag.querySelector('[sf-layout]');\n    if (layoutDiv && args.form.grid) {\n        Object.getOwnPropertyNames(args.form.grid).forEach(function (property, idx, array) {\n            layoutDiv.setAttribute(property, args.form.grid[property]);\n        });\n    }\n}\n;\nmodule\n    .config([\"sfErrorMessageProvider\", function (sfErrorMessageProvider) {\n        sfErrorMessageProvider.setDefaultMessage(\"302\", \"[{{title}}]是必填项\");\n        sfErrorMessageProvider.setDefaultMessage(\"103\", \"[{{title}}]超过了最大值{{schema.maximum}}\");\n        sfErrorMessageProvider.setDefaultMessage(\"101\", \"[{{title}}]小于最小值{{schema.minimum}}\");\n        sfErrorMessageProvider.setDefaultMessage(\"200\", \"[{{title}}]字符长度小于最小值({{schema.minLength}})\");\n        sfErrorMessageProvider.setDefaultMessage(\"201\", \"[{{title}}]字符长度大于最大值({{schema.maxLength}})\");\n        sfErrorMessageProvider.setDefaultMessage(\"400\", \"数组长度不正确，{{schema.minItems||0}}-{{schema.maxItems||'∞'}}\");\n        sfErrorMessageProvider.setDefaultMessage(\"500\", \"格式不正确\");\n    }])\n    .config([\"sfBuilderProvider\", \"schemaFormDecoratorsProvider\", \"jsonEditorBuilderProvider\", \"autoCompleteBuilderProvider\", function (sfBuilderProvider, schemaFormDecoratorsProvider, jsonEditorBuilder, autoCompleteBuilder) {\n        schemaFormDecoratorsProvider.defineAddOn('materialDecorator', 'jeditor', \"./decorators/jsoneditor.jade\", sfBuilderProvider.stdBuilders.concat(jsonEditorBuilder.builder));\n        schemaFormDecoratorsProvider.defineAddOn('materialDecorator', 'card', \"./decorators/card.jade\", [sfBuilderProvider.builders.sfField, sfBuilderProvider.builders.condition, sfBuilderProvider.builders.transclusion]);\n        schemaFormDecoratorsProvider.defineAddOn('materialDecorator', 'autocomplete-1', \"./decorators/autocomplete-1.jade\", [sfBuilderProvider.builders.sfField, sfLayout, sfBuilderProvider.builders.condition, autoCompleteBuilder.builder, sfBuilderProvider.builders.transclusion]);\n        schemaFormDecoratorsProvider.defineAddOn('materialDecorator', 'section-1', \"./decorators/section-1.jade\", [sfBuilderProvider.builders.sfField, sfBuilderProvider.builders.ngModel, sfBuilderProvider.builders.condition, sfBuilderProvider.builders.simpleTransclusion, sfBuilderProvider.builders.array]);\n    }])\n    .run([\"$templateCache\", \"autoCompleteBuilder\", function ($templateCache) {\n        $templateCache.put('./decorators/jsoneditor.jade', require(\"./decorators/jsoneditor.jade\")());\n        $templateCache.put('./decorators/card.jade', require(\"./decorators/card.jade\")());\n        $templateCache.put('./decorators/autocomplete-1.jade', require(\"./decorators/autocomplete-1.jade\")());\n        $templateCache.put('./decorators/section-1.jade', require(\"./decorators/section-1.jade\")());\n    }]);\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = module.name;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/directives/action/index.ts\n ** module id = 36\n ** module chunks = 0\n **/","\"use strict\";\nvar action_model_1 = require('../models/action.model');\nvar Controller = (function () {\n    function Controller($scope, $timeout, fxAction, toolbarUtils, materialUtils, $mdDialog) {\n        var _this = this;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.fxAction = fxAction;\n        this.toolbarUtils = toolbarUtils;\n        this.materialUtils = materialUtils;\n        this.$mdDialog = $mdDialog;\n        this.isShow = true;\n        this.selectedIndex = 0;\n        this.initToolbar();\n        this.$scope.$on(\"$destroy\", function () {\n            _this.formData = null;\n            _this.$forms = null;\n            _this.toolbars = null;\n            _this.actionModel = null;\n        });\n    }\n    Controller.prototype.initForm = function (action, $scope) {\n        if (!this.$forms) {\n            this.$forms = {};\n        }\n        this.$forms[action.key] = $scope[(action.key + \"Form\")];\n    };\n    Controller.prototype.showForm = function (action, index) {\n        return index === 0 || this.$forms.hasOwnProperty(action.key) || index == this.selectedIndex || index == this.selectedIndex + 1;\n    };\n    Controller.prototype.doCheckCurrentForm = function (index) {\n        var actionModel = this.actionModel.wizard.actions[_.isUndefined(index) ? this.selectedIndex : index];\n        if (this.$forms) {\n            var formController = this.$forms[(\"\" + actionModel.key)];\n            if (!this.fxAction.doFormCheck(formController)) {\n                return false;\n            }\n        }\n        return true;\n    };\n    Controller.prototype.doCheckForms = function () {\n        var _this = this;\n        var res = true;\n        _.each(this.actionModel.wizard.actions, function (action, index) {\n            res = _this.doCheckCurrentForm(index);\n            if (!res) {\n                _this.selectedIndex = index;\n                return false;\n            }\n        });\n        return res;\n    };\n    Controller.prototype.reset = function () {\n        var _this = this;\n        this.formData = {};\n        this.$forms = {};\n        this.selectedIndex = 0;\n        this.isShow = false;\n        this.$timeout(function () {\n            _this.isShow = true;\n        }, 0);\n    };\n    Controller.prototype.initToolbar = function () {\n        var _this = this;\n        this.toolbars = [\n            this.toolbarUtils.btnBuilder(\"上一步\", null, true, \"top\").iconBuilder(\"navigate_before\").conditionBuilder(\"wizardCtl.selectedIndex>0\", false).btnClick(function ($event) {\n                _this.selectedIndex && _this.selectedIndex--;\n            }).toValue(),\n            this.toolbarUtils.btnBuilder(\"下一步\", null, true, \"top\").iconBuilder(null, null, \"navigate_next\").conditionBuilder(\"wizardCtl.selectedIndex < wizardCtl.actionModel.wizard.actions.length-1\", false).btnClick(function ($event) {\n                if (_this.doCheckCurrentForm() && _.isArray(_this.actionModel.wizard.actions) && _this.actionModel.wizard.actions.length > _this.selectedIndex) {\n                    _this.selectedIndex++;\n                }\n            }).toValue(),\n            this.toolbarUtils.btnBuilder(\"完成\", \"md-primary\", true, \"top\").iconBuilder(\"done_all\").conditionBuilder(\"!wizardCtl.isBusy && wizardCtl.selectedIndex===wizardCtl.actionModel.wizard.actions.length-1\", false).btnClick(function ($event) {\n                if (_this.doCheckForms()) {\n                    _this.isBusy = true;\n                    _this.fxAction.doAction(_this.actionModel.key, _this.formData).then(function (result) {\n                        _this.actionModel.closeDialog === true && _this.$mdDialog.hide(result);\n                        if (_.isFunction(_this.submitCallBack)) {\n                            _this.submitCallBack();\n                        }\n                        _this.materialUtils.showMsg(_this.actionModel.successMsg || \"操作成功！\");\n                        _this.reset();\n                    }).finally(function () {\n                        _this.isBusy = false;\n                    });\n                }\n            }).toValue()\n        ];\n    };\n    Controller.prototype.getActionModel = function () {\n        var _this = this;\n        var actionModel;\n        this.fxAction.getModel(this.key).then(function (model) {\n            actionModel = _.cloneDeep(model);\n            return _this.fxAction.getModels(model.wizard.actions);\n        }).then(function (actionModels) {\n            var actions = [];\n            _.each(actionModel.wizard.actions, function (action) {\n                if (_.isString(action)) {\n                    action = actionModels[action];\n                }\n                if (action && (action.type === action_model_1.ActionType.form || action.type === action_model_1.ActionType.wizard)) {\n                    if (!action.form.dataSchema && action.type === action_model_1.ActionType.form) {\n                        action.form.dataSchema = actionModel.wizard.defaultSchema.dataSchema;\n                    }\n                    actions.push(action);\n                }\n            });\n            actionModel.wizard.actions = actions;\n            _this.actionModel = actionModel;\n        });\n    };\n    Controller.$inject = [\"$scope\", \"$timeout\", \"fxAction\", \"toolbarUtils\", \"materialUtils\", \"$mdDialog\"];\n    return Controller;\n}());\nfunction Directive() {\n    return {\n        restrict: 'EA',\n        template: require(\"../tpls/wizard.jade\")(),\n        scope: true,\n        require: \"^fxWizardAction\",\n        bindToController: {\n            formData: \"=ngModel\",\n            submitCallBack: \"=?\",\n            key: \"@\"\n        },\n        controller: Controller,\n        controllerAs: 'wizardCtl',\n        replace: true,\n        transclude: true,\n        link: function ($scope, $ele, $attr, $ctl) {\n            $scope.$watch(function () {\n                return $ctl.key;\n            }, function () {\n                $ctl.getActionModel();\n            });\n        }\n    };\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = function (module) {\n    module.directive(\"fxWizardAction\", Directive);\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/directives/action/directives/wizard.directive.ts\n ** module id = 59\n ** module chunks = 0\n **/"],"sourceRoot":""}