{"version":3,"sources":["webpack:///./src/pages/tty/router.ts?881d","webpack:///./src/pages/tty/ctls/index.controller.ts?9a6e"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB,sBAAqB;AACrB,kBAAiB;AACjB,cAAa;AACb;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,2CAA0C;AAC1C;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA,EAAC;AACD","file":"0.d3a0d7eff46265dae37c.hot-update.js","sourcesContent":["\"use strict\";\nvar index_controller_1 = require('./ctls/index.controller');\nexports.initRouter = function ($urlRouterProvider, $stateProvider) {\n    $stateProvider.state(\"home.tty\", {\n        url: \"tty\",\n        data: {\n            permissions: {\n                except: [\"anonymous\"],\n                only: [\"user\"]\n            }\n        },\n        views: {\n            \"content\": {\n                controller: index_controller_1.TtyController,\n                controllerAs: \"ttyCtl\",\n                template: require(\"./tpls/index.template.jade\")()\n            }\n        }\n    });\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pages/tty/router.ts\n ** module id = 186\n ** module chunks = 0\n **/","\"use strict\";\nvar io = require('socket.io-client');\nvar TtyController = (function () {\n    function TtyController($scope, $stateParams, toolbarUtils, materialUtils, fxAction) {\n        var _this = this;\n        this.$scope = $scope;\n        this.$stateParams = $stateParams;\n        this.toolbarUtils = toolbarUtils;\n        this.materialUtils = materialUtils;\n        this.fxAction = fxAction;\n        this.crawlers = {};\n        this.logs = [];\n        this.itemToolbar = [\n            toolbarUtils.btnBuilder(\"执行操作\", \"\", true).btnClick(function ($event, crawler) {\n                _this.fxAction.getModel(\"crawlerSettingAckAction\").then(function (actionModel) {\n                    _this.fxAction.doActionModel($event, actionModel, crawler, function () {\n                        _this.socket.emit('ack', crawler, function (result) {\n                            if (result.ret === 0) {\n                                _this.materialUtils.showMsg(\"操作成功！\");\n                            }\n                            else {\n                                _this.materialUtils.showErrMsg(result.msg);\n                            }\n                        });\n                    });\n                });\n            }).toValue()\n        ];\n        this.$scope.$on(\"$destroy\", function () {\n            _this.socket.disconnect();\n            _this.crawlers = {};\n        });\n        this.init();\n    }\n    TtyController.prototype.init = function () {\n        var _this = this;\n        this.socket = io('http://localhost:3000/crawler');\n        this.socket.on('connect', function () {\n            console.log(\"connected!!\");\n        });\n        this.socket.on('disconnect', (function () {\n            _this.crawlers = {};\n            _this.materialUtils.showErrMsg(\"socket失去连接！！！\");\n        }).bind(this));\n        this.socket.on(\"crawler:left\", (function (socketId) {\n            if (_this.crawlers.hasOwnProperty(socketId)) {\n                _this.materialUtils.safeApply(_this.$scope, function () {\n                    delete _this.crawlers[socketId];\n                });\n            }\n        }).bind(this));\n        this.socket.on(\"crawler:update\", (function (result) {\n            if (_this.crawlers.hasOwnProperty(result.socketId)) {\n                _this.materialUtils.safeApply(_this.$scope, function () {\n                    _.extend(_this.crawlers[result.socketId], result.data);\n                });\n            }\n        }).bind(this));\n        this.socket.on(\"crawler:log\", (function (result) {\n            if (_this.logs.length > 100) {\n                _this.logs.shift();\n            }\n            _this.logs.push(result.data);\n        }).bind(this));\n        this.socket.on('crawler:join', (function (data) {\n            if (!_this.crawlers) {\n                _this.crawlers = {};\n            }\n            _this.materialUtils.safeApply(_this.$scope, function () {\n                _this.crawlers[data.id] = data.data;\n            });\n        }).bind(this));\n        this.socket.emit(\"getCrawlers\", {}, (function (crawlers) {\n            _this.materialUtils.safeApply(_this.$scope, function () {\n                _this.crawlers = crawlers;\n            });\n        }).bind(this));\n    };\n    TtyController.$inject = [\"$scope\", \"$stateParams\", \"toolbarUtils\", \"materialUtils\", \"fxAction\"];\n    return TtyController;\n}());\nexports.TtyController = TtyController;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pages/tty/ctls/index.controller.ts\n ** module id = 187\n ** module chunks = 0\n **/"],"sourceRoot":""}